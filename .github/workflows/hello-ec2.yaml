name: Test EC2 Connection

# ssh -o StrictHostKeyChecking=no 
# -i ~/.ssh/clouds2025.pem -p 12137 
# ubuntu@13.125.218.128

on:
  workflow_dispatch:  # 수동 실행 가능

jobs:
  test-connection:
    name: Test EC2 SSH Connection
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Test SSH Connection to EC2
        env:
          PRIVATE_KEY: ${{ secrets.EC2_PRIVATE_KEY }}
          HOSTNAME: ${{ secrets.EC2_SSH_HOST }}
          USER_NAME: ${{ secrets.EC2_USER_NAME }}
        run: |
          echo "SSH 연결 테스트를 시작합니다..."
          
          # SSH 개인키 파일 생성 및 권한 설정
          echo "$PRIVATE_KEY" > private_key && chmod 600 private_key
          cat private_key    
          
          echo "SSH 연결 테스트가 완료되었습니다."

      - name: Cleanup
        if: always()
        run: |
          rm -f private_key
